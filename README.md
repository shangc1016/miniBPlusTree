### sqlet



part11  

在上一小节中，B+树实现了叶子结点的split以及叶子结点生成三个节点、包含内部节点的B+树。但是这个B+树不能插入，原因是get_page找到插入位置的时候，不能处理内部节点。

1、首先实现设置插入游标的时候，可以处理内部节点。根据内部节点记录的各个子树的最大key值判断应该递归到哪个子树中查找插入位置。  
2、完成之后，可以在多个节点的B+树上插入数据了，但是select查询数据还不可以。因为select是根据叶子结点的记录长度来遍历的。

> 插入15条数据，然后select。发现打印错误。原因是错误的把内部节点当做叶子结点，把内部节点的子节点数量当做叶子结点的记录条数(这两个字段的相对偏移一样)。然后当做表中只有一个叶子结点。把内部节点当做叶子结点，（因为前面create_new_root的时候，根节点的数据拷贝到了left child，所以root节点仍然保留了原来的数据。）总之就是table_start把内部节点当做叶子结点了。

<img src="https://note-img-1300721153.cos.ap-nanjing.myqcloud.com/md-imgimage-20220922155723330.png" alt="image-20220922155723330" style="zoom: 33%;" />
















































------

pager这个抽象结构：

输入：页号
输出：得到物理页面
